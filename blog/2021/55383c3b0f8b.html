<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title>Vedfolnir</title><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=1.0.0"><script>var CONFIG = {
  theme: {"images":"images","js":"js","css":"css","post":{"excerpt":false,"tags":true,"tags_icon":"fa-solid fa-hashtag"},"post_meta":{"created":{"enable":true,"icon":false},"updated":{"enable":false,"icon":false},"reading_time":{"enable":true,"icon":false},"word_count":{"enable":false,"icon":false}},"icon":{"paginator_prev":"fa-solid fa-chevron-left","paginator_next":"fa-solid fa-chevron-right"},"logo":null,"header":{"fixed":true,"blur":true},"menu":{"home":"/ || fas fa-home"},"menu_settings":{"icon_only":false,"text_only":true},"back2top":{"enable":true,"icon":"fa-solid fa-arrow-up"},"footer":{"copyright":{"enable":true,"start":2017,"end":null,"author":"C1oudust"},"beian":{"enable":true,"text":"冀ICP备 - 19035656号"},"powered":{"enable":true}},"dark_mode":{"enable":true,"default":"dark"},"layout":{"content":"768px","sidebar":"300px","content_sidebar_gap":"30px","main_padding":{"default":"20px","tablet":"15px","mobile":"10px"}},"pjax":{"enable":true,"avoid_banner":false,"elements":null,"selectors":null,"switches":null,"switchesOptions":null,"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0}},
};
var Util = window.Util || {};
window.CONFIG = CONFIG;</script><script>function getDarkMode() {
  var darkMode = false;
  try {
    if (localStorage.getItem('dark') == '1') {
      darkMode = true;
    }
    else if(!localStorage.getItem('dark')){
      if (!localStorage.getItem('dark') && CONFIG.theme.dark_mode.default == 'dark'){
        darkMode = true;
      }
      if (window.matchMedia('(prefers-color-scheme: dark)').matches){
        darkMode = true;
      }
    }
  } catch (err) {
    /* empty */
    console.log('err',err)
  }
  return darkMode;
}

if (getDarkMode()) {
  document.querySelector('html').classList = 'dark';
}</script><meta name="generator" content="Hexo 6.3.0"></head><body><header class="header"><nav class="nav"><div class="spacer"></div><div class="menu"><a class="menu-item" href="/" title="首页"><span class="menu-item__text">首页</span></a><div class="dark-mode"><a><svg xmlns="http://www.w3.org/2000/svg" class="mode-button-moon" viewBox="0 0 24 24" width="1.2em" height="1.2em" style="vertical-align: sub;display:none"><path fill="currentColor" d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A7.999 7.999 0 0 0 4 12z"></path></svg></a><a><svg xmlns="http://www.w3.org/2000/svg" class="mode-button-sun" viewBox="0 0 24 24" width="1.2em" height="1.2em" style="vertical-align: sub;display:none"><path fill="currentColor" d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></a></div></div></nav></header><main class="main"><div id="is-post"></div><div class="post-header"><h1 class="post-title slide-enter-50">使用uniapp开发跨平台app</h1><div class="post-meta slide-enter-50"><span class="item-meta--createtime">10-05</span><span class="item-meta--readtime">· 13分钟</span></div></div><article><div class="content slide-enter-content"><p>之前一段时间尝试过使用 uniapp 来开发安卓&#x2F;ios 的 APP，踩过很多坑，为了解决问题几乎翻遍了整个 dcloud 社区，最后成功上线了几款产品。因此对一些功能的实现来做一个总结，方便以后查看。</p>
<span id="more"></span>


        <h2 id=""   >
          <a href="#前提注明" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="前提注明"></div>
          <a href="#前提注明" class="headerlink" title="前提注明"></a>前提注明
        </h2>
      <ul>
<li>不使用 nvue，原因见<a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/id-36044__page-2">uni-app 大法好 ，nvue 从入坑到放弃</a></li>
</ul>
<p>注明：官方推荐长列表使用 nvue 做性能更好，问题在于 nvue 的限制极其离谱，如果长列表项目不是很多，建议不要用 nvue，如果列表项目很多，建议 flutter 或者原生开发。</p>
<ul>
<li>需要用到 H5+ 的一些方法，参考 <a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/h5p.html">HTML5+ API Reference</a></li>
</ul>

        <h2 id=""   >
          <a href="#设备相关" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="设备相关"></div>
          <a href="#设备相关" class="headerlink" title="设备相关"></a>设备相关
        </h2>
      <ol>
<li>获取设备 ID 或唯一标识符:<ul>
<li><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/36075">获取设备信息（imei、imsi、uuid）的调整使用 plus.device.getInfo 方法的说明</a></li>
<li><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/system/info?id=getsysteminfo">uni.getSystemInfo(OBJECT)</a></li>
</ul>
</li>
<li>获取平台：<ul>
<li><code>plus.device.vendor</code> IOS 返回<code>&#39;Apple&#39;</code></li>
<li><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/system/info?id=getsysteminfo">uni.getSystemInfo(OBJECT)</a> platform &#x3D;&gt; ios android</li>
</ul>
</li>
</ol>

        <h2 id=""   >
          <a href="#自定义隐私政策" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="自定义隐私政策"></div>
          <a href="#自定义隐私政策" class="headerlink" title="自定义隐私政策"></a>自定义隐私政策
        </h2>
      <p><code>manifest.json</code> 里配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;app-plus&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;privacy&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;prompt&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;custom&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在<code>onLoad</code>中使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!plus.<span class="property">runtime</span>.<span class="title function_">isAgreePrivacy</span>()) &#123;</span><br><span class="line">  <span class="comment">// 如果没有同意隐私政策，同意后不再触发</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">showCustomPrivacy</span> = <span class="literal">true</span>; <span class="comment">// 展示自定义隐私授权框</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 正常流程，获取信息等</span></span><br></pre></td></tr></table></figure>

<p>隐私政策弹窗的两个按钮需要两个方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">agreePrivacy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    plus.<span class="property">runtime</span>.<span class="title function_">agreePrivacy</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">showCustomPrivacy</span> = <span class="literal">false</span>; <span class="comment">// 隐藏弹框</span></span><br><span class="line">    <span class="comment">// 正常流程，获取信息等</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">disagreePrivacy</span>(<span class="params"></span>) &#123;</span><br><span class="line">    plus.<span class="property">runtime</span>.<span class="title function_">disagreePrivacy</span>();</span><br><span class="line">    plus.<span class="property">runtime</span>.<span class="title function_">quit</span>(); <span class="comment">// 退出APP</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>文档 ： <a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/36937">Android 平台隐私与政策提示框配置方法</a></p>

        <h2 id=""   >
          <a href="#适配" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="适配"></div>
          <a href="#适配" class="headerlink" title="适配"></a>适配
        </h2>
      
        <h3 id=""   >
          <a href="#状态栏适配（使用自定义导航栏）" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="状态栏适配（使用自定义导航栏）"></div>
          <a href="#状态栏适配（使用自定义导航栏）" class="headerlink" title="状态栏适配（使用自定义导航栏）"></a>状态栏适配（使用自定义导航栏）
        </h3>
      <ol>
<li><p>非全屏 APP 下外部容器设置 <code>padding-top: var(--status-bar-height);</code></p>
<p><code>--status-bar-height</code>是官方提供的 css 变量，表示状态栏高度</p>
</li>
<li><p>单独写一个元素做占位符，高度为<code>var(--status-bar-height)</code></p>
</li>
<li><p>但这个 api 只能拿到状态栏高度，要想适配异性还需要进行其他配置。</p>
</li>
</ol>

        <h3 id=""   >
          <a href="#状态栏样式" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="状态栏样式"></div>
          <a href="#状态栏样式" class="headerlink" title="状态栏样式"></a>状态栏样式
        </h3>
      <p>默认值：<code>manifest.json</code>文件的 app-plus-&gt;statusbar-&gt;style 配置 支持 light 和 dark （根据文档设置了，然而没用）</p>
<p>在<code>page.json</code>里设置 <code>&quot;navigationBarTextStyle &quot;:&quot;white&quot;</code>，完美解决所有问题。</p>
<p>动态设置： plus.navigator.setStatusBarStyle(style); 需要在页面 onReady 和 onShow 里调用，这个 api 在 onLoad 里调用无效，切换页面导致颜色改变后返回不会触发 onReady，因此需要在 onShow 里再次调用，但是只在 onShow 里调用又会失效。</p>
<p>沉浸式状态栏 page.json 里配置：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;app-plus&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;immersed&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


        <h3 id=""   >
          <a href="#导航栏" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="导航栏"></div>
          <a href="#导航栏" class="headerlink" title="导航栏"></a>导航栏
        </h3>
      <ul>
<li><p>使用原生导航栏</p>
<p><code>page.json</code>相关页面中设置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;navigationStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>自定义导航栏</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;style&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;navigationStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;custom&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;navigationBarTextStyle&quot;</span><span class="punctuation">:</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> <span class="comment">// 导航栏颜色</span></span><br><span class="line">  <span class="attr">&quot;app-plus&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;titleNView&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span> <span class="comment">// 关闭原生导航栏</span></span><br><span class="line">      <span class="attr">&quot;scrollIndicator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>

        <h3 id=""   >
          <a href="#ios-安全区" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="ios-安全区"></div>
          <a href="#ios-安全区" class="headerlink" title="ios 安全区"></a>ios 安全区
        </h3>
      <p>见第一个文档。</p>
<p>文档</p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35564">uni-app 全面屏、刘海屏适配（iphoneX 适配）及安全区设置</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/421">Android 平台设置沉浸式状态栏显示效果</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/1150">状态栏大全-状态栏透明(沉浸式)、变色及全屏的区别</a></p>
<p><del><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/33">iOS 平台设置系统状态栏（通知栏、顶部状态栏）样式背景颜色或透明</a></del></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/34921">uni-app 导航栏开发指南</a></p>

        <h2 id=""   >
          <a href="#支付" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="支付"></div>
          <a href="#支付" class="headerlink" title="支付"></a>支付
        </h2>
      <ol>
<li><code>manifest.json</code> 中打开支付相关选项。微信支付需要填写与 APP 包名绑定的 <code>appid</code> 值，否则无法支付。</li>
<li>调用 <code>uni.getProvider</code>(安卓) 或 <code>plus.payment.getChannels</code> &#x3D;&gt; <code>requestOrder</code>（IOS）获取支持的支付提供商 &#x2F; 渠道。</li>
<li>传入参数至<code>uni.requestPayment</code>，不同支付渠道参数格式不同。</li>
</ol>

        <h3 id=""   >
          <a href="#关于苹果内购的问题" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="关于苹果内购的问题"></div>
          <a href="#关于苹果内购的问题" class="headerlink" title="关于苹果内购的问题"></a>关于苹果内购的问题
        </h3>
      <p>苹果经常出现调用 api 后无法有弹窗的问题，参考文档:</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/haibo0668/article/details/104413662">苹果支付(内购项目)回调验证<em>php 菜鸟技术天地-CSDN 博客</em>苹果支付回调</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35501">苹果 ISO 内购支付，支付成功，但是回调不执行问题 - DCloud 问答</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35573">苹果内购 的经验分享 - DCloud 问答</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35516">支付接口问题, 终于搞定了! 特写这封感谢信! - DCloud 问答</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/37682">分享苹果内购 requestPayment 没有任何返回 - DCloud 问答</a></p>
<p>详细见文档。</p>
<p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/plugins/payment?id=orderinfo">支付 - uni-app 官网</a></p>

        <h2 id=""   >
          <a href="#登录" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="登录"></div>
          <a href="#登录" class="headerlink" title="登录"></a>登录
        </h2>
      
        <h3 id=""   >
          <a href="#云函数" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="云函数"></div>
          <a href="#云函数" class="headerlink" title="云函数"></a>云函数
        </h3>
      <p>这里使用 uniapp 的云函数实现短信发送和获取一键登录的手机号：</p>
<p>大致流程 ： 右键项目文件夹 &#x3D;&gt; 创建 uniCloud 云开发环境 &#x3D;&gt; 创建一个并关联 &#x3D;&gt; 右键 cloudfunctions 文件夹，新建云函数 &#x3D;&gt; 完成后右键上传云函数。</p>

        <h3 id=""   >
          <a href="#一键登录" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="一键登录"></div>
          <a href="#一键登录" class="headerlink" title="一键登录"></a>一键登录
        </h3>
      <p>首先通过云函数获取手机号</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">main</span> = <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> uniCloud.<span class="title function_">getPhoneNumber</span>(&#123;</span><br><span class="line">    <span class="attr">appid</span>: <span class="string">&#x27;__UNI__D2A5305&#x27;</span>, <span class="comment">// 替换成自己开通一键登录的应用的DCloud appid，使用callFunction方式调用时可以不传（会自动取当前客户端的appid），如果使用云函数URL化的方式访问必须传此参数</span></span><br><span class="line">    <span class="attr">provider</span>: <span class="string">&#x27;univerify&#x27;</span>,</span><br><span class="line">    <span class="attr">apiKey</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 在开发者中心开通服务并获取apiKey   （这里是Luka大叔星座馆的）</span></span><br><span class="line">    <span class="attr">apiSecret</span>: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 在开发者中心开通服务并获取apiSecret</span></span><br><span class="line">    <span class="attr">access_token</span>: event.<span class="property">access_token</span>,</span><br><span class="line">    <span class="attr">openid</span>: event.<span class="property">openid</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">code</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>: res,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>客户端调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">login</span>(&#123;</span><br><span class="line">    <span class="attr">provider</span>: <span class="string">&#x27;univerify&#x27;</span>, <span class="comment">// 一键登录的标识</span></span><br><span class="line">    <span class="attr">univerifyStyle</span>: &#123;...&#125;,<span class="comment">// 自定义登录框样式,参考文档中的配置</span></span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>)&#123; <span class="comment">// 登录成功</span></span><br><span class="line">        <span class="keyword">let</span> result = self.<span class="title function_">quickLogin</span>(res.<span class="property">authResult</span>); <span class="comment">// &#123;openid:&#x27;登录授权唯一标识&#x27;,access_token:&#x27;接口返回的 token&#x27;&#125;</span></span><br><span class="line">        <span class="keyword">let</span> phoneNum = result.<span class="property">result</span>.<span class="property">data</span>.<span class="property">phoneNumber</span>; <span class="comment">// 获取到用户手机号</span></span><br><span class="line">        ...</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">fail</span>(<span class="params">res</span>)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">async</span> <span class="title function_">quickLogin</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> uniCloud.<span class="title function_">callFunction</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;quickLogin&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: data</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>成功或失败时都使用 <code>uni.closeAuthView()</code> 关闭一键登录弹窗</p>

        <h3 id=""   >
          <a href="#手机短信验证码登录" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="手机短信验证码登录"></div>
          <a href="#手机短信验证码登录" class="headerlink" title="手机短信验证码登录"></a>手机短信验证码登录
        </h3>
      <p>通过云函数发送验证码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">main</span> = <span class="keyword">async</span> (event, context) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="keyword">await</span> uniCloud.<span class="title function_">sendSms</span>(event);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>uniCloud.sendSms()</code>的参数格式参考文档，这里为后端接口的返回值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="title function_">sendSms</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> res = <span class="keyword">await</span> uniCloud.<span class="title function_">callFunction</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;sendSms&#x27;</span>,</span><br><span class="line">            <span class="attr">data</span>: data</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> err;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        <h3 id=""   >
          <a href="#第三方渠道登录" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="第三方渠道登录"></div>
          <a href="#第三方渠道登录" class="headerlink" title="第三方渠道登录"></a>第三方渠道登录
        </h3>
      <p>首先需要在进入页面时获取登录渠道</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getProvider</span>(&#123;</span><br><span class="line">  <span class="attr">service</span>: <span class="string">&#x27;oauth&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;oauth success:&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(res));</span><br><span class="line">    res.<span class="property">provider</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      self.<span class="property">providerList</span>.<span class="title function_">push</span>(value);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>通过 providerList 中的值展示三方渠道登录按钮</p>
<p>调用 api 实现登录</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">login</span>(&#123;</span><br><span class="line">  <span class="attr">provider</span>: provider,</span><br><span class="line">  <span class="attr">success</span>: <span class="function">(<span class="params">loginRes</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 登录成功后可以获取用户信息，每个平台信息核实不太一样，这里选择传给后端接口获取一个统一的信息格式</span></span><br><span class="line">    uni.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">      <span class="attr">provider</span>: provider,</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">fail</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


        <h3 id=""   >
          <a href="#其他问题" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="其他问题"></div>
          <a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题
        </h3>
      <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">uni.<span class="title function_">getSystemInfo</span>(&#123;</span><br><span class="line">  <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">platform</span> == <span class="string">&#x27;ios&#x27;</span>) &#123;</span><br><span class="line">      self.<span class="property">canUseAppleLogin</span> = <span class="built_in">parseInt</span>(res.<span class="property">system</span>) &gt;= <span class="number">13</span>; <span class="comment">// ios13+ 支持苹果登录，低版本和安卓手机做兼容处理</span></span><br><span class="line">      plus.<span class="property">oauth</span>.<span class="title function_">getServices</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 判断是否安装微信选择展示微信登录</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          self.<span class="property">isWXInstalled</span> = plus.<span class="property">ios</span>.<span class="keyword">import</span>(<span class="string">&#x27;WXApi&#x27;</span>).<span class="title function_">isWXAppInstalled</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


        <h3 id=""   >
          <a href="#参考文档" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="参考文档"></div>
          <a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档
        </h3>
      <p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/univerify">uni 一键登录</a></p>
<p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/uniCloud/send-sms">短信发送</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/id-36651">iOS 苹果授权登录（Sign in with Apple）&#x2F;Apple 登录&#x2F;苹果登录集成教程</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/id-934__page-2">安卓打包后，微信登录提示“认证失败，原因：用户取消”</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/question/108054">QQ 登录鉴权报错</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/295">该怎么判断是否已安装微信和 QQ？</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/100254781">uni-app 如何判断是否安装腾讯 QQ 微信微博支付宝淘宝客户端</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/question/77931">uni-app 怎么注销微信或者 qq 的授权登录？有 uni.logout 这个方法吗？</a></p>

        <h2 id=""   >
          <a href="#分享" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="分享"></div>
          <a href="#分享" class="headerlink" title="分享"></a>分享
        </h2>
      <p>文档：<a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/api/plugins/share?id=share">分享</a></p>
<p>参考代码（分享至微信朋友圈）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">shareWX</span>(<span class="params"></span>) &#123;</span><br><span class="line">    uni.<span class="title function_">share</span>(&#123;</span><br><span class="line">        <span class="attr">provider</span>: <span class="string">&#x27;weixin&#x27;</span>,</span><br><span class="line">        <span class="attr">scene</span>: <span class="string">&#x27;WXSenceTimeline&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">imageUrl</span>: self.<span class="property">savetopimgurl</span>, <span class="comment">// 需要分享的图片地址</span></span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&#x27;分享成功&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">            uni.<span class="title function_">showToast</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: err.<span class="property">errMsg</span>.<span class="title function_">includes</span>(<span class="string">&#x27;未安装&#x27;</span>) ? <span class="string">&#x27;微信客户端未安装&#x27;</span> : <span class="string">&#x27;分享失败，请检查您的网络&#x27;</span>,</span><br><span class="line">                <span class="attr">icon</span>: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


        <h2 id=""   >
          <a href="#推送" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="推送"></div>
          <a href="#推送" class="headerlink" title="推送"></a>推送
        </h2>
      <p>获取客户端位移标识，用于定向推送，并在首次进入 APP 时上报</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pinf = plus.<span class="property">push</span>.<span class="title function_">getClientInfo</span>();</span><br><span class="line"><span class="keyword">var</span> cid = pinf.<span class="property">clientid</span>; <span class="comment">//客户端标识</span></span><br></pre></td></tr></table></figure>

<p>使用<code>plus.push.createMessage()</code>方法创建本地推送消息。</p>
<p>使用<code>plus.push.addEventListener(&#39;receive&#39;,()=&gt;&#123;&#125;)</code>接受推送信息并在回调中创建本地推送。</p>
<p>参考代码已经封装成 push.js，在 main.js 中 import 即可。<br>push.js 内容如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">透传消息内容格式</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">	&quot;title&quot;:&quot;测试标题&quot;,</span></span><br><span class="line"><span class="comment">	&quot;type&quot;:&quot;receive&quot;,</span></span><br><span class="line"><span class="comment">	&quot;content&quot;:&quot;测试内容&quot;,</span></span><br><span class="line"><span class="comment">	&quot;payload&quot;:&quot;&#123;\&quot;id\&quot;:\&quot;1\&quot;,\&quot;jump\&quot;:\&quot;1\&quot;,\&quot;url\&quot;:\&quot;/pages/home/find\&quot;&#125;&quot;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">pushReady</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// plus.push.createMessage(&#x27;点击进入页面&#x27;, JSON.stringify(&#123;</span></span><br><span class="line">    <span class="comment">// 	id: &#x27;61534&#x27;,</span></span><br><span class="line">    <span class="comment">// 	url: &quot;/pages/home/index&quot;,</span></span><br><span class="line">    <span class="comment">// 	jump: &#x27;1&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;), &#123;</span></span><br><span class="line">    <span class="comment">// 	title: &#x27;这是自定义标题哦&#x27;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">// plus.nativeUI.toast(&#x27;plus ready&#x27;)</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">jumpToPage</span>(<span class="params">payload</span>) &#123;</span><br><span class="line">      <span class="comment">// plus.nativeUI.toast(&#x27;push jump：&#x27; + JSON.stringify(payload))</span></span><br><span class="line">      <span class="keyword">const</span> url = payload.<span class="property">url</span> + <span class="string">&#x27;?pushId=&#x27;</span> + payload.<span class="property">id</span>;</span><br><span class="line">      <span class="comment">// plus.nativeUI.toast(url)</span></span><br><span class="line">      <span class="keyword">if</span> (payload.<span class="property">jump</span> == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">        uni.<span class="title function_">switchTab</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: url,</span><br><span class="line">          <span class="title function_">success</span>(<span class="params">r</span>) &#123;</span><br><span class="line">            <span class="comment">// plus.nativeUI.toast(&#x27;switch succ&#x27; + JSON.stringify(r))</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="title function_">fail</span>(<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="comment">// plus.nativeUI.toast(&#x27;switch err&#x27; + JSON.stringify(e))</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        uni.<span class="title function_">navigateTo</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>: url,</span><br><span class="line">          <span class="title function_">success</span>(<span class="params">r</span>) &#123;</span><br><span class="line">            plus.<span class="property">nativeUI</span>.<span class="title function_">toast</span>(<span class="string">&#x27;navigate succ&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(r));</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="title function_">fail</span>(<span class="params">e</span>) &#123;</span><br><span class="line">            plus.<span class="property">nativeUI</span>.<span class="title function_">toast</span>(<span class="string">&#x27;navigate err&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e));</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">createPushOBj</span>(<span class="params">msg, type</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">title</span>: msg.<span class="property">title</span>,</span><br><span class="line">        <span class="attr">content</span>: msg.<span class="property">content</span>,</span><br><span class="line">        <span class="attr">id</span>: msg.<span class="property">payload</span>.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">jump</span>: msg.<span class="property">payload</span>.<span class="property">jump</span>,</span><br><span class="line">        <span class="attr">url</span>: msg.<span class="property">payload</span>.<span class="property">url</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    plus.<span class="property">push</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">      <span class="comment">// IOS后台的消息是msg.payload对象,前台的消息是msg.payload字符串</span></span><br><span class="line">      <span class="comment">// plus.nativeUI.toast(&#x27;click:&#x27; + JSON.stringify(msg))</span></span><br><span class="line">      <span class="keyword">if</span> (msg.<span class="property">payload</span>.<span class="property">id</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">jumpToPage</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(msg.<span class="property">payload</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">jumpToPage</span>(msg.<span class="property">payload</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 安卓的推送，点击后触发receive,IOS的通知点击的时候触发click监听器</span></span><br><span class="line">    <span class="comment">// ios使用透传，接收后触发receive</span></span><br><span class="line">    plus.<span class="property">push</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;receive&#x27;</span>, <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">      plus.<span class="property">nativeUI</span>.<span class="title function_">toast</span>(<span class="string">&#x27;receive:&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(msg));</span><br><span class="line">      <span class="keyword">let</span> payload = msg.<span class="property">payload</span>;</span><br><span class="line">      <span class="comment">// IOS接收后创建本地消息,本地消息会再次触发receive,所以判断是否本地创建的,将其它数据封装在payload(需为字符串)中</span></span><br><span class="line">      <span class="comment">// 直发时，content = payload = &#123;&#125;</span></span><br><span class="line">      <span class="keyword">if</span> (plus.<span class="property">os</span>.<span class="property">name</span> !== <span class="string">&#x27;Android&#x27;</span> &amp;&amp; msg.<span class="property">type</span> === <span class="string">&#x27;receive&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> content = msg.<span class="property">content</span>;</span><br><span class="line">        <span class="keyword">let</span> title = msg.<span class="property">title</span>;</span><br><span class="line">        <span class="keyword">let</span> pl = &#123;</span><br><span class="line">          <span class="attr">title</span>: title,</span><br><span class="line">          <span class="attr">content</span>: content,</span><br><span class="line">          <span class="attr">id</span>: payload.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">jump</span>: payload.<span class="property">jump</span>,</span><br><span class="line">          <span class="attr">url</span>: payload.<span class="property">url</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        plus.<span class="property">push</span>.<span class="title function_">createMessage</span>(content, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(pl), &#123;</span><br><span class="line">          <span class="attr">title</span>: title,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (plus.<span class="property">os</span>.<span class="property">name</span> === <span class="string">&#x27;Android&#x27;</span> &amp;&amp; msg.<span class="property">content</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;&#123;&#x27;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">        plus.<span class="property">nativeUI</span>.<span class="title function_">toast</span>(<span class="string">&#x27;payload:&#x27;</span> + payload);</span><br><span class="line">        payload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(payload);</span><br><span class="line">        <span class="keyword">let</span> content = msg.<span class="property">content</span>;</span><br><span class="line">        <span class="keyword">let</span> title = msg.<span class="property">title</span>;</span><br><span class="line">        <span class="keyword">let</span> pl = <span class="title function_">createPushOBj</span>(msg);</span><br><span class="line">        <span class="comment">// plus.nativeUI.toast(content + &#x27;_&#x27; + JSON.stringify(pl))</span></span><br><span class="line">        plus.<span class="property">push</span>.<span class="title function_">createMessage</span>(content, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(pl), &#123;</span><br><span class="line">          <span class="attr">title</span>: title,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (plus.<span class="property">os</span>.<span class="property">name</span> === <span class="string">&#x27;Android&#x27;</span> &amp;&amp; msg.<span class="property">content</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;&#123;&#x27;</span>) === -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> payload = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(msg.<span class="property">payload</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> pl = &#123;</span><br><span class="line">          <span class="attr">title</span>: msg.<span class="property">title</span>,</span><br><span class="line">          <span class="attr">content</span>: msg.<span class="property">content</span>,</span><br><span class="line">          <span class="attr">id</span>: payload.<span class="property">id</span>,</span><br><span class="line">          <span class="attr">jump</span>: payload.<span class="property">jump</span>,</span><br><span class="line">          <span class="attr">url</span>: payload.<span class="property">url</span>,</span><br><span class="line">        &#125;;</span><br><span class="line">        plus.<span class="property">push</span>.<span class="title function_">createMessage</span>(msg.<span class="property">content</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(pl), &#123;</span><br><span class="line">          <span class="attr">title</span>: title,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//#ifdef APP-PLUS</span></span><br><span class="line">  <span class="title function_">pushReady</span>();</span><br><span class="line">  <span class="comment">//#endif</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>参考：</p>
<p><a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/push.html">API Reference Push</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35622">UniPush 使用指南 - DCloud 问答</a></p>

        <h2 id=""   >
          <a href="#其他参考" class="header-anchor" aria-hidden="true">#</a>
          <div style="position:relative;top:-6rem" id="其他参考"></div>
          <a href="#其他参考" class="headerlink" title="其他参考"></a>其他参考
        </h2>
      <p>iOS App 第一次安装启动后，会弹出是否允许联网的询问框，在用户点击同意前，调用联网 API 会失败。因此如果有信息需要在 create 或者 mount 方法中获取的话，就要做兼容处理，否则会导致用户首次进入 APP 时获取不到信息。</p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/94">manifest.json 文档说明</a></p>
<p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/use-html5plus">使用 HTML5+ 注意事项 - uni-app 官网</a></p>
<p><a target="_blank" rel="noopener" href="https://uniapp.dcloud.io/matter?id=h5%E6%AD%A3%E5%B8%B8%E4%BD%86app%E5%BC%82%E5%B8%B8%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7">H5 正常但 App 异常的可能性</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/36393#unilink">iOS 云打包如何设置通用链接等 Capabilities 配置</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/36445">iOS 平台微信 SDK 更新需要配置通用链接（Universal Links）</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35173">关于 IOS 缓存本地图片读取显示空白的问题解决办法</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/35138">前万小心,安卓跟 IOS 获取本地文件的区别</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/115">Uploader(文件上传)问题汇总</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/m/article/35627">uni-app 运行环境版本和编译器版本不一致的问题</a></p>
<p><a target="_blank" rel="noopener" href="http://doc.itwlw.com/web/">5+API 错误代码</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/676">监听短信验证码并自动提交表单</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/409">Android 平台设置 UrlSchemes，实现被第三方应用调用</a></p>
<p><a target="_blank" rel="noopener" href="https://ask.dcloud.net.cn/article/36982">Android 平台云端打包权限配置 - DCloud 问答</a></p>
<p><a target="_blank" rel="noopener" href="http://cdn.c1oudust.cn/static/push.js">push.js</a></p>
</div></article><div class="post-footer"><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fa-solid fa-hashtag"></i></span><a class="post-tags-item__link" href="https://c1oudust.cn/tags/%E5%89%8D%E7%AB%AF/">前端</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fa-solid fa-hashtag"></i></span><a class="post-tags-item__link" href="https://c1oudust.cn/tags/Vue/">Vue</a></span><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fa-solid fa-hashtag"></i></span><a class="post-tags-item__link" href="https://c1oudust.cn/tags/app/">app</a></span></div><nav class="post-paginator paginator"><div class="paginator-inner"><a class="paginator-prev prev extend" href="/blog/2021/a8e23abd32f7.html" title="使用el-upload组件上传图片至七牛云"><i class="fa-solid fa-chevron-left"></i></a><a class="paginator-next next extend" href="/blog/2021/62544c10439f.html" title="LayaBox安卓APP接入微信登录"><i class="fa-solid fa-chevron-right"></i></a></div></nav></div></main><footer class="footer"><div class="footer-info"><span>2017-2023 </span><div class="icon">©</div><span>C1oudust</span><span class="devider">|</span><a class="beian" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">冀ICP备 - 19035656号</a></div><div class="footer-powered"><span>Powered by <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a></span></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><i class="back2top__icon fa-solid fa-arrow-up"></i></div><script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js"></script><script>window.addEventListener('DOMContentLoaded', function () {
  var pjax = new Pjax({"selectors":["head title",".main",".pjax-reload"],"history":true,"scrollTo":false,"scrollRestoration":false,"cacheBust":false,"debug":false,"currentUrlFullReload":false,"timeout":0});
  // 加载进度条的计时器
  var loadingTimer = null;

  // 重置页面 Y 方向上的滚动偏移量
  document.addEventListener('pjax:send', function () {
    var loadingBarWidth = 20;
    var MAX_LOADING_WIDTH = 95;

    $('.loading-bar').addClass('loading');
    $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    clearInterval(loadingTimer);
    loadingTimer = setInterval(function () {
      loadingBarWidth += 3;
      if (loadingBarWidth > MAX_LOADING_WIDTH) {
        loadingBarWidth = MAX_LOADING_WIDTH;
      }
      $('.loading-bar__progress').css('width', loadingBarWidth + '%');
    }, 500);
  }, false);

  window.addEventListener('pjax:complete', function () {
    clearInterval(loadingTimer);
    $('.loading-bar__progress').css('width', '100%');
    $('.loading-bar').removeClass('loading');
    setTimeout(function () {
      $('.loading-bar__progress').css('width', '0');
    }, 400);
    $('link[rel=prefetch], script[data-pjax-rm]').each(function () {
      $(this).remove();
    });
    $('script[data-pjax], #pjax-reload script').each(function () {
      $(this).parent().append($(this).remove());
    });
    //- if (Stun.utils.pjaxReloadBoot) {
    //-   Stun.utils.pjaxReloadBoot();
    //- }
    //- if (Stun.utils.pjaxReloadScroll) {
    //-   Stun.utils.pjaxReloadScroll();
    //- }
    //- if (Stun.utils.pjaxReloadSidebar) {
    //-   Stun.utils.pjaxReloadSidebar();
    //- }
    //- Util.initHeader();

    //- }
  }, false);
}, false);</script><script src="/js/header.js?v=1.0.0"></script><script src="/js/utils.js?v=1.0.0"></script><script src="/js/scroll.js?v=1.0.0"></script><script src="/js/canvas.js?v=1.0.0"></script></body></html>